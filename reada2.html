<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-blue-grey.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        html, body, h1, h2, h3, h4, h5 {font-family: "Open Sans", sans-serif}
    </style>
    <title>Reading</title>
</head>
<body class="w3-theme-l5">

<div class="w3-top">
    <div class="w3-bar w3-white w3-left-align w3-large w3-card">
        <a href="#" class="w3-bar-item"><img src="img/logo.png" class="w3-image" style="height: 35px;"></a>
        <span class="w3-bar-item w3-padding-large">READING</span>
    </div>
</div>

<div class="w3-container w3-content" style="max-width: 1400px; margin-top: 80px;">

<div class="w3-card w3-round w3-white">
    <div class="w3-container w3-large">
        <p id="texto">I just returned from the greatest summer vacation! It was so fantastic, I never wanted it to end. I spent eight days in Paris, France. My best friends, Henry and Steve, went with me. We had a beautiful hotel room in the Latin Quarter, and it wasn’t even expensive. We had a balcony with a wonderful view.</p>
    </div>
</div>

<br>

<div>
    <div class="w3-container w3-large">
        <p id="output"></p>
    </div>
</div>

<br>

<div class="w3-container w3-large w3-row-padding w3-center">
    <div class="w3-col s4">
        <button class="w3-button w3-theme-d4 w3-round" onclick="refresh()">Refresh &nbsp; <i class="fa fa-refresh"></i></button>
    </div>
    <div class="w3-col s4">
        <button class="w3-button w3-theme-d4 w3-round" onclick="stopSpeechRecognition()">Stop &nbsp; <i class="fa fa-stop"></i></button>
    </div>
    <div class="w3-col s4">
        <button class="w3-button w3-theme-d4 w3-round" onclick="runSpeechRecognition()">Play &nbsp; <i class="fa fa-play"></i></button>
    </div>
</div>

<br><br>

<br><br><br><br>

</div>


<script>

//let textos = ["Martha is at the grocery store, getting ready for a house party. She has a list of what she needs with her as she goes along. The first section she comes has produce. Martha sees apples, bananas, cherries, grapes, and strawberries.","Martha gets her items and looks the bananas. They are on sale for much cheaper than they are normally. She picks 3 bananas. Next are vegetables. She sees potatoes, carrots, tomatoes, onions, mushrooms, and salad in bags.","As she is putting her items into her cart, Martha checks the many bags of salad and chooses 2 of them. She pushes her cart ahead. The next section is meat and dairy. She sees meat, fish, cheese, eggs, and milk.","She looks at the meat that is on sale and chooses a 5-pound roll of hamburger. She gets the rest of the items in that section. She still needs rice, bread, salt, sugar, and flour","Martha then realizes that she has forgotten something. She runs back and gets 1 container of salt and then rushes to the checkout. She puts her groceries into her car and leaves.",'There are seven days of the week, or uniquely named 24-hour periods designed to provide scheduling context and make time more easily measureable. Each of these days is identifiable by specific plans, moods, and tones.','Monday is viewed by many to be the "worst" day of the week, as it marks the return to work following the weekend, when most full-time employees are given two days off. Most students attend school in the morning and return home in the afternoon (usually from about eight until three or seven until two), and most workers go to work in the morning and return home in the evening (usually from nine to five or eight to four).','Wednesday is the third day of the week, and serves as the "middle" of the work week; some individuals refer to Wednesday as "hump day," as once its workday is complete, employees will have passed the work-week "hump," and will be on the downturn, as only two days on the job will remain in the week.',"Thursday is the fourth day of the week, and is viewed favorably by many, as it's rather close to the end of the work week.","Friday is the fifth day of the week, and marks the end of the workweek and school-week for the vast majority of employees and students. By Friday evening, most students cannot wait to leave and go home, as they won't have to report back to school until Monday.","Saturday is perhaps the most highly regarded day of the week. Because Sunday follows it (and there is presumably no work or school to attend, for most individuals), everyone is free to stay out (or awake) until late at night, having fun with plans or other leisure-related activities. To be sure, Saturday is generally thought of as a day to partake in hobbies that couldn't otherwise be enjoyed during the regular week.","Sunday is the final day of the week, and is used by most as a day of rest. Fewer late-night plans are made on Sundays, compared to Saturdays, as most individuals have to wake up for work or school on Monday morning.",'Tuesday is the second day of the week, and is in many ways similar to Monday. Not a whole lot of changes, schedule-wise, between Tuesday and Monday; most individuals go to school or work and return home to watch television, play video games, make plans with friends, spend time with family, read, or engage in a similar leisure-related activity.','Lucas goes to school every day of the week. He has many subjects to go to each school day: English, art, science, mathematics, gym, and history. His mother packs a big backpack full of books and lunch for Lucas.','His first class is English, and he likes that teacher very much. His English teacher says that he is a good pupil, which Lucas knows means that she thinks he is a good student.','His next class is art. He draws on paper with crayons and pencils and sometimes uses a ruler. Lucas likes art. It is his favorite class.','His third class is science. This class is very hard for Lucas to figure out, but he gets to work with his classmates a lot, which he likes to do. His friend, Kyle, works with Lucas in science class, and they have fun.','Then Lucas gets his break for lunch. He sits with Kyle while he eats. The principal, or the headmaster as some call him, likes to walk around and talk to students during lunch to check that they are all behaving.','The next class is mathematics, which most of the students just call math. Kyle has trouble getting a good grade in mathematics, but the teacher is very nice and helpful.','History is his last class of the day. Lucas has a hard time staying awake. Many lessons are boring, and he is very tired after doing gym.',"I just returned from the greatest summer vacation! It was so fantastic, I never wanted it to end. I spent eight days in Paris, France. My best friends, Henry and Steve, went with me. We had a beautiful hotel room in the Latin Quarter, and it wasn’t even expensive. We had a balcony with a wonderful view.", 'We visited many famous tourist places. My favorite was the Louvre, a well-known museum. I was always interested in art, so that was a special treat for me. The museum is so huge, you could spend weeks there. Henry got tired walking around the museum and said “Enough! I need to take a break and rest.”','We took lots of breaks and sat in cafes along the river Seine. The French food we ate was delicious. The wines were tasty, too. Steve’s favorite part of the vacation was the hotel breakfast. He said he would be happy if he could eat croissants like those forever. We had so much fun that we’re already talking about our next vacation!'];
let textos = ["Yes, he is confirmed on flight 103 from Los Angeles to Hawaii at noon. He does not have any bags to check in but has one small carry-on bag that he will take with him","The agent prints out his boarding pass. The airport security officers walk past him with a big dog","The dog is sniffing around people’s luggage trying to detect drugs and explosives. Miguel is relieved when he sees the dog walk past him",'Suddenly, the dog turns and begins to sniff his bag and bark. The security officer looks at Miguel. “Sir, please bring your bag and come with me.”',"Miguel is standing in line at the airport. It is his turn and he walks to the counter. The lady at the counter asks him for his ID and she checks his flight details","Francisco stands outside his new house. He reaches into his pocket and pulls out the key. He turns the key in the lock and opens the door","He steps into the living room and looks around. The paint is peeling off the walls. There is no furniture"," The house is dirty and smells bad. He tries to open a window but it is broken. The house does not have a kitchen or a bedroom but there is a microwave on the floor on one side of the room","He wonders if it works. The place looks terrible but it is all he can afford. He covers his nose and mouth with his hand and opens the bathroom door. It is in bad condition","My name is Sangeeta. I am 11. I live in New Delhi, India with my father, mother, two brothers and three sisters","My grandparents also live with us. In India, family is very important.","It is common to have grandparents, aunts, uncles and/or cousins living in the same house","My aunts, uncles and cousins also live nearby. We see each other often"," My older brother is a computer programmer. Right now, he is in Australia. His company sent him there for one year.","We all miss him a lot. We write him letters every week. I want him to come home soon.","Hello! My name is Ana. I am twenty-five years old. I live in Miami, Florida with my husband and two children"," I have one son in kindergarten and one daughter in first grade","They both attend public school. My husband is a mechanic. On weekends, he works at a restaurant as a dishwasher","The restaurant usually gets more customers on weekends, so they need extra people to wash dishes","Hi Cristina, I am sorry I haven’t called you for so long. How are you? How is your new apartment? I have been very busy at work.","I arrive at the office at 7 am and leave at around 6:30 pm. I just get half an hour for lunch and a five-minute break in the morning and in the afternoon.","I am very tired when I get home so I just eat, watch some television and go to bed. In the office, I am on the phone all day, listening to customer complaints and entering them into our computer system","At the end of the day I have to write a summary of all the calls I received during the day and give my boss a status on the complaints that are not yet resolved","I do not know how much longer I can do this. I need a vacation, or even better, I need another job! I’ll call you this weekend."];
let num = 0;

let output = document.getElementById("output");
let texto = document.getElementById("texto");

let recognition;

function runSpeechRecognition() {
  event.preventDefault();
  var output = document.getElementById("output");

  // new speech recognition object
  var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
  recognition = new SpeechRecognition();

  // Recogniser doesn't stop listening even if the user pauses
    recognition.continuous = true;
	recognition.lang = 'en-US';
	recognition.interimResults = true;

  // This runs when the speech recognition service returns result
  recognition.onresult = function(event) {
                    /*
					let transcript = event.results[0][0].transcript;
          let confidence = event.results[0][0].confidence;
          output.innerHTML = "<b>Text:</b> " + transcript + "<br/> <b>Confidence:</b> " + confidence*100+"%";
          output.classList.remove("hide");*/

					output.innerHTML ="";
					let len = event.results.length;
					for (let i = event.resultIndex; i < len; i++) {
						/*if (event.results[i].isFinal) {
							output.innerHTML = event.results[i][0].transcript + ' (Confidence: ' + event.results[i][0].confidence + ')';
						} else {
							output.innerHTML+= event.results[i][0].transcript;
						}*/
						output.innerHTML+= event.results[i][0].transcript;
					}
					/**/
  };

  recognition.addEventListener('error', function(event) {
		console.log('Speech recognition error detected: ' + event.error);
		runSpeechRecognition();
	});

  recognition.addEventListener('error', runSpeechRecognition);

  // This runs when the speech recognition service starts
  recognition.onstart = function() {
    output.innerHTML = "<small>listening, please speak...</small>";
  };

  recognition.onspeechend = function() {
    recognition.stop();
  }

  recognition.start();
}

function stopSpeechRecognition() {
	console.log("stoped");
    recognition.continuous = false;
	recognition.stop();
    limpia();
}

function refresh() {
    reload();
    output.innerHTML = "";
}

function reload(){
    num = Math.floor(Math.random() * (textos.length));
    texto.innerHTML = textos[num];
}

function limpia(){
    let res = texto.innerHTML;
    res = res.replace(/,/g, "");
    res = res.replace(/\./g, "");
    res = res.replace(/\(/g, "");
    res = res.replace(/\)/g, "");
    res = res.replace(/\-/g, " ");
    res = res.replace(/\:/g, "");
    res = res.replace(/\“/g, "");
    res = res.replace(/\”/g, "");
    res = res.replace(/\"/g, "");
    res = res.replace(/\;/g, "");
    res = res.replace(/\!/g, "");
    res = res.replace(/\?/g, "");
    res = res.replace(/\//g, "");
    console.log(res);
    let arr_texto = res.split(" ");
    console.log(arr_texto);
    if(output.innerHTML != ""){
        let arr_speak = output.innerHTML.split(" ");
        console.log(arr_speak);

        let p = "";
        let errors = [];
        for (let i = 0; i < arr_texto.length; i++) {
            let a = false;
            let num = 0;
            for (let x = i-3; x < i+3; x++) {
                if(typeof arr_speak[x] !== 'undefined'){
                    if (arr_texto[i].toLowerCase() == arr_speak[x].toLowerCase()) {
                        a = true;
                        break;
                    }
                }
            }
            if (a==false) {
                errors.push(arr_texto[i]);
            }
        }

        console.log(errors);

        for (let i = 0; i < arr_texto.length; i++) {
            let a = false;
            for (let x = 0; x < errors.length; x++) {
                if (errors[x].toLowerCase() == arr_texto[i].toLowerCase()) {
                    p +=' <span class="w3-text-red">'+arr_texto[i]+"</span>";
                    a = true;
                    errors.splice(x, 1);
                    break;
                }
            }
            if (a==false) {
                p +=' '+arr_texto[i];
            }
        }
        output.innerHTML += "<br><br>"+p;
        //p +=' '+arr_speak[x];
        //p +=' <span class="w3-text-red">'+arr_speak[i]+"</span>";
    }
}

reload();


</script>
    
</body>
</html>